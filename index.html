<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="src/css/style.css">
  <script defer src="static/js/alpine.js"></script>
  <title>Countries</title>
</head>

<body>
  <!-- x-init="loadCountries()" -->
  <main id="container" class="center" x-data="{ 
      regions: ['Africa', 'Americas', 'Antarctic', 'Antarctic Ocean', 'Asia', 'Europe', 'Oceania', 'Polar'],
      searchQuery: '',
      countries: loadCountries()
      }">

    <!-- form input and search -->
    <form class="container">
      <!-- @input.camel="searchInput" -->
      <input type="search" x-model="searchQuery" name="search" id="search" placeholder="Search...">
      <select>
        <option value="" selected>Filter by Region</option>
        <template x-for="selectedRegion in regions" :key="crypto.randomUUID()">
          <option x-text="selectedRegion" value="selectedRegion"></option>
        </template>
      </select>
    </form>

    <!-- cards -->
    <template id="content" class="flex center" x-for="country in countries" :key="country.alpha3Code">

      <article class="card flex-card" x-show="true">
        <div class="img">
          <img loading="lazy" :src="country.flags.svg" :alt="country.name" width="750" height="750">
        </div>
        <div class="info">
          <h3 class="country" :data-country-name="country.name" x-text="country.name"></h3>
          <p class="info__detail">Population: <span class="population" :data-population="country.population" x-text="country.population"></span> </p>
          <p class="info__detail">Region: <span class="region" :data-region="country.region" x-text="country.region"></span></p>
          <p class="info__detail">Capital: <span class="capital" :data-capital="country.capital" x-text="country.capital"></span></p>
        </div>
      </article>
    </template>
    <div class="countries"></div>
  </main>
  <!--<script src="static/js/htmx.min.js"></script> -->
  <!-- <script src="src/js/main.js"></script> -->
  <script>
    async function loadCountries() {
      try {
        const response = await fetch('data.min.json');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json()
        return data
      } catch (error) {
        console.error('Error fetching data:', error);
        return [];
      }
    }

    // function searchInput(e) {
    //   // let searchQuery = ''
    //   searchQuery += e.target.value
    //   console.log(searchQuery)
    // }


    function handleData(regions, searchCountry) {
      const data = loadCountries()
      for (let i = 0; i < data.length; i++) {
        if (regions != '') {
          return data.filter(data[i] == selectedRegion)
        }
        if (searchQuery != '') {
          return data.filter(data.name == 'searchQuery')

        }
      }
    }
  </script>

</body>

</html>